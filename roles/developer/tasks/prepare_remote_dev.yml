---
- name: Odoo Dev | Preparar entorno de desarrollo local de Odoo
  tags: remote_dev
  become: false
  block:
    - name: Odoo Dev | Refrescar conexi√≥n para aplicar cambios de grupo (ej. docker)
      ansible.builtin.meta: reset_connection

    - name: Odoo Dev | Crear directorio base 'odoo'
      ansible.builtin.file:
        path: "{{ developer_odoo_base_path }}"
        state: directory
        mode: '0755'

    - name: Odoo Dev | Verificar si el directorio ctx existe
      ansible.builtin.stat:
        path: "{{ developer_odoo_base_path }}/ctx"
      register: developer_ctx_dir

    - name: Odoo Dev | Clonar/actualizar repositorio docker-compose-context a 'ctx'
      ansible.builtin.git:
        repo: "{{ developer_odoo_ctx_repo }}"
        dest: "{{ developer_odoo_base_path }}/ctx"
        version: main
        accept_hostkey: true
        update: true
        force: true

    - name: Odoo Dev | Verificar si el directorio 18 existe
      ansible.builtin.stat:
        path: "{{ developer_odoo_base_path }}/18"
      register: developer_18_dir

    - name: Odoo Dev | Clonar/actualizar repositorio docker-compose-odoo a '18'
      ansible.builtin.git:
        repo: "{{ developer_odoo_main_repo }}"
        dest: "{{ developer_odoo_base_path }}/18"
        version: main
        accept_hostkey: true
        update: true
        force: true
