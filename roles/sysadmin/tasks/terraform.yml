---
- name: SysAdmin - Instalar terraform cli
  block:
    - name: Terraform - Borrar binario existente si existe
      file:
        path: /usr/local/bin/terraform
        state: absent
      ignore_errors: true

    - name: Terraform - Descargar y agregar la clave GPG de HashiCorp
      shell: |
        wget -O- https://apt.releases.hashicorp.com/gpg | sudo gpg --dearmor -o /usr/share/keyrings/hashicorp-archive-keyring.gpg
      become: true

    - name: Terraform - AÃ±adir repositorio de HashiCorp
      shell: |
        echo "deb [signed-by=/usr/share/keyrings/hashicorp-archive-keyring.gpg] https://apt.releases.hashicorp.com $(lsb_release -cs) main" | sudo tee /etc/apt/sources.list.d/hashicorp.list
      become: true

    - name: Terraform - Actualizar lista de paquetes e instalar terraform
      shell: sudo apt update && sudo apt install -y terraform
      become: true

    - name: Terraform - Autocomplete package
      become_user: "{{ remote_regular_user }}"
      command: "terraform -install-autocomplete"
      changed_when: False
  tags: terraform
