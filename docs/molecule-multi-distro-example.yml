---
# Ejemplo de molecule.yml con múltiples distribuciones
# Ubicación: roles/funcional/molecule/default/molecule.yml
#
# INSTRUCCIONES DE USO:
# 1. Por defecto, mantener solo Debian 12 + Ubuntu 22.04 (rápido)
# 2. Para validación completa, descomentar Debian 13 y Ubuntu 24.04
# 3. Verificar disponibilidad de imágenes Docker antes de agregar

dependency:
  name: galaxy
  options:
    requirements-file: ../../../../collections/requirements.yml
    force: false

driver:
  name: docker

platforms:
  # ============================================
  # PLATAFORMAS POR DEFECTO (siempre activas)
  # ============================================
  
  - name: debian12-funcional
    image: geerlingguy/docker-debian12-ansible:latest
    command: ""
    volumes:
      - /sys/fs/cgroup:/sys/fs/cgroup:rw
    cgroupns_mode: host
    privileged: true
    pre_build_image: true
    tmpfs:
      - /run
      - /tmp

  - name: ubuntu2204-funcional
    image: geerlingguy/docker-ubuntu2204-ansible:latest
    command: ""
    volumes:
      - /sys/fs/cgroup:/sys/fs/cgroup:rw
    cgroupns_mode: host
    privileged: true
    pre_build_image: true
    tmpfs:
      - /run
      - /tmp

  # ============================================
  # PLATAFORMAS ADICIONALES (descomentar según necesidad)
  # ============================================
  
  # Debian 13 (Trixie) - Testing/Unstable
  # ⚠️ Verificar disponibilidad: docker pull geerlingguy/docker-debian13-ansible:latest
  # ⚠️ Algunos paquetes pueden no estar disponibles
  # - name: debian13-funcional
  #   image: geerlingguy/docker-debian13-ansible:latest
  #   command: ""
  #   volumes:
  #     - /sys/fs/cgroup:/sys/fs/cgroup:rw
  #   cgroupns_mode: host
  #   privileged: true
  #   pre_build_image: true
  #   tmpfs:
  #     - /run
  #     - /tmp

  # Ubuntu 24.04 LTS (Noble)
  # ✅ Estable y totalmente soportado
  # ✅ Recomendado para validación de compatibilidad LTS
  # - name: ubuntu2404-funcional
  #   image: geerlingguy/docker-ubuntu2404-ansible:latest
  #   command: ""
  #   volumes:
  #     - /sys/fs/cgroup:/sys/fs/cgroup:rw
  #   cgroupns_mode: host
  #   privileged: true
  #   pre_build_image: true
  #   tmpfs:
  #     - /run
  #     - /tmp

provisioner:
  name: ansible
  config_options:
    defaults:
      callbacks_enabled: timer, profile_tasks
      stdout_callback: yaml
      roles_path: ../../../../roles
  inventory:
    host_vars:
      debian12-funcional:
        ansible_user: root
      ubuntu2204-funcional:
        ansible_user: root
      # Descomentar si activas las plataformas adicionales:
      # debian13-funcional:
      #   ansible_user: root
      # ubuntu2404-funcional:
      #   ansible_user: root
  playbooks:
    converge: converge.yml

verifier:
  name: ansible

scenario:
  name: default
  test_sequence:
    - dependency
    - syntax
    - create
    - prepare
    - converge
    - idempotence
    - verify
    - destroy

# NOTAS DE USO:
#
# 1. Testing con 2 distros (rápido - ~15 min):
#    molecule test
#
# 2. Testing con 4 distros (completo - ~35 min):
#    - Descomentar debian13 y ubuntu2404 arriba
#    - molecule test
#
# 3. Testing de una sola distro:
#    molecule create --platform-name ubuntu2404-funcional
#    molecule converge --platform-name ubuntu2404-funcional
#    molecule verify --platform-name ubuntu2404-funcional
#    molecule destroy --platform-name ubuntu2404-funcional
#
# 4. Ver todas las plataformas:
#    molecule list
#
# 5. Logs de un contenedor:
#    docker logs debian13-funcional
#
# TIEMPO ESTIMADO POR DISTRO:
# - Primera ejecución: ~8-10 minutos
# - Idempotencia: ~2-3 minutos
# - Verify: ~30 segundos
#
# RECOMENDACIONES:
# - Desarrollo diario: 2 distros (Debian 12 + Ubuntu 22.04)
# - Pull Requests: 3 distros (+ Ubuntu 24.04)
# - Releases: 4 distros (si Debian 13 disponible)
